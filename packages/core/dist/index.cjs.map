{"version":3,"sources":["../src/utils.ts","../src/pool.ts","../src/wasm.ts","../src/index.ts"],"names":["module","logger"],"mappings":"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","file":"index.cjs","sourcesContent":["/**\r\n * ComputeKit Utilities\r\n * Helper functions for the WASM + Worker toolkit\r\n */\r\n\r\n/**\r\n * Generate a unique ID\r\n */\r\nexport function generateId(): string {\r\n  return `${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 11)}`;\r\n}\r\n\r\n/**\r\n * Check if running in a Web Worker context\r\n */\r\nexport function isWorkerContext(): boolean {\r\n  return (\r\n    typeof self !== 'undefined' &&\r\n    typeof Window === 'undefined' &&\r\n    typeof self.postMessage === 'function'\r\n  );\r\n}\r\n\r\n/**\r\n * Check if running in a browser context\r\n */\r\nexport function isBrowserContext(): boolean {\r\n  return typeof window !== 'undefined' && typeof document !== 'undefined';\r\n}\r\n\r\n/**\r\n * Check if SharedArrayBuffer is available\r\n */\r\nexport function isSharedArrayBufferAvailable(): boolean {\r\n  try {\r\n    return typeof SharedArrayBuffer !== 'undefined';\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Check if WASM is supported\r\n */\r\nexport function isWasmSupported(): boolean {\r\n  try {\r\n    if (typeof WebAssembly === 'object') {\r\n      const module = new WebAssembly.Module(\r\n        Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00)\r\n      );\r\n      return module instanceof WebAssembly.Module;\r\n    }\r\n  } catch {\r\n    // WASM not supported\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Get the number of logical processors\r\n */\r\nexport function getHardwareConcurrency(): number {\r\n  if (typeof navigator !== 'undefined' && navigator.hardwareConcurrency) {\r\n    return navigator.hardwareConcurrency;\r\n  }\r\n  return 4; // Reasonable default\r\n}\r\n\r\n/**\r\n * Create a deferred promise\r\n */\r\nexport interface Deferred<T> {\r\n  promise: Promise<T>;\r\n  resolve: (value: T | PromiseLike<T>) => void;\r\n  reject: (reason?: unknown) => void;\r\n}\r\n\r\nexport function createDeferred<T>(): Deferred<T> {\r\n  let resolve!: (value: T | PromiseLike<T>) => void;\r\n  let reject!: (reason?: unknown) => void;\r\n\r\n  const promise = new Promise<T>((res, rej) => {\r\n    resolve = res;\r\n    reject = rej;\r\n  });\r\n\r\n  return { promise, resolve, reject };\r\n}\r\n\r\n/**\r\n * Create a timeout promise\r\n */\r\nexport function createTimeout(ms: number, message?: string): Promise<never> {\r\n  return new Promise((_, reject) => {\r\n    setTimeout(() => {\r\n      reject(new Error(message || `Operation timed out after ${ms}ms`));\r\n    }, ms);\r\n  });\r\n}\r\n\r\n/**\r\n * Race a promise against a timeout\r\n */\r\nexport async function withTimeout<T>(\r\n  promise: Promise<T>,\r\n  ms: number,\r\n  message?: string\r\n): Promise<T> {\r\n  return Promise.race([promise, createTimeout(ms, message)]);\r\n}\r\n\r\n/**\r\n * Detect transferable objects in data\r\n */\r\nexport function findTransferables(data: unknown): Transferable[] {\r\n  const transferables: Transferable[] = [];\r\n  const seen = new WeakSet();\r\n\r\n  function traverse(obj: unknown): void {\r\n    if (obj === null || typeof obj !== 'object') return;\r\n    if (seen.has(obj as object)) return;\r\n    seen.add(obj as object);\r\n\r\n    if (obj instanceof ArrayBuffer) {\r\n      transferables.push(obj);\r\n      return;\r\n    }\r\n\r\n    if (ArrayBuffer.isView(obj)) {\r\n      transferables.push(obj.buffer);\r\n      return;\r\n    }\r\n\r\n    if (obj instanceof MessagePort) {\r\n      transferables.push(obj);\r\n      return;\r\n    }\r\n\r\n    if (typeof ImageBitmap !== 'undefined' && obj instanceof ImageBitmap) {\r\n      transferables.push(obj);\r\n      return;\r\n    }\r\n\r\n    if (typeof OffscreenCanvas !== 'undefined' && obj instanceof OffscreenCanvas) {\r\n      transferables.push(obj);\r\n      return;\r\n    }\r\n\r\n    if (Array.isArray(obj)) {\r\n      obj.forEach(traverse);\r\n      return;\r\n    }\r\n\r\n    if (obj instanceof Map) {\r\n      obj.forEach((value, key) => {\r\n        traverse(key);\r\n        traverse(value);\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (obj instanceof Set) {\r\n      obj.forEach(traverse);\r\n      return;\r\n    }\r\n\r\n    Object.values(obj).forEach(traverse);\r\n  }\r\n\r\n  traverse(data);\r\n  return transferables;\r\n}\r\n\r\n/**\r\n * Clone data, detaching transferables\r\n */\r\nexport function cloneForTransfer<T>(data: T): { data: T; transfer: Transferable[] } {\r\n  const transfer = findTransferables(data);\r\n  return { data, transfer };\r\n}\r\n\r\n/**\r\n * Create a typed event emitter\r\n */\r\nexport type EventHandler<T = unknown> = (data: T) => void;\r\n\r\nexport class EventEmitter<TEvents extends Record<string, unknown>> {\r\n  private handlers = new Map<keyof TEvents, Set<EventHandler>>();\r\n\r\n  on<K extends keyof TEvents>(event: K, handler: EventHandler<TEvents[K]>): () => void {\r\n    if (!this.handlers.has(event)) {\r\n      this.handlers.set(event, new Set());\r\n    }\r\n    this.handlers.get(event)!.add(handler as EventHandler);\r\n\r\n    // Return unsubscribe function\r\n    return () => this.off(event, handler);\r\n  }\r\n\r\n  off<K extends keyof TEvents>(event: K, handler: EventHandler<TEvents[K]>): void {\r\n    this.handlers.get(event)?.delete(handler as EventHandler);\r\n  }\r\n\r\n  emit<K extends keyof TEvents>(event: K, data: TEvents[K]): void {\r\n    this.handlers.get(event)?.forEach((handler) => {\r\n      try {\r\n        handler(data);\r\n      } catch (err) {\r\n        console.error(`Error in event handler for ${String(event)}:`, err);\r\n      }\r\n    });\r\n  }\r\n\r\n  removeAllListeners(event?: keyof TEvents): void {\r\n    if (event) {\r\n      this.handlers.delete(event);\r\n    } else {\r\n      this.handlers.clear();\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Simple LRU cache\r\n */\r\nexport class LRUCache<K, V> {\r\n  private cache = new Map<K, V>();\r\n  private maxSize: number;\r\n\r\n  constructor(maxSize: number = 100) {\r\n    this.maxSize = maxSize;\r\n  }\r\n\r\n  get(key: K): V | undefined {\r\n    const value = this.cache.get(key);\r\n    if (value !== undefined) {\r\n      // Move to end (most recently used)\r\n      this.cache.delete(key);\r\n      this.cache.set(key, value);\r\n    }\r\n    return value;\r\n  }\r\n\r\n  set(key: K, value: V): void {\r\n    if (this.cache.has(key)) {\r\n      this.cache.delete(key);\r\n    } else if (this.cache.size >= this.maxSize) {\r\n      // Delete oldest (first) entry\r\n      const firstKey = this.cache.keys().next().value;\r\n      if (firstKey !== undefined) {\r\n        this.cache.delete(firstKey);\r\n      }\r\n    }\r\n    this.cache.set(key, value);\r\n  }\r\n\r\n  has(key: K): boolean {\r\n    return this.cache.has(key);\r\n  }\r\n\r\n  delete(key: K): boolean {\r\n    return this.cache.delete(key);\r\n  }\r\n\r\n  clear(): void {\r\n    this.cache.clear();\r\n  }\r\n\r\n  get size(): number {\r\n    return this.cache.size;\r\n  }\r\n}\r\n\r\n/**\r\n * Serialize function to string for worker\r\n */\r\n// eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\r\nexport function serializeFunction(fn: Function): string {\r\n  return fn.toString();\r\n}\r\n\r\n/**\r\n * Estimate the byte size of a value for structured cloning.\r\n * This is an approximation useful for debugging and performance monitoring.\r\n */\r\nexport function estimatePayloadSize(value: unknown): number {\r\n  if (value === null || value === undefined) return 0;\r\n  if (typeof value === 'boolean') return 4;\r\n  if (typeof value === 'number') return 8;\r\n  if (typeof value === 'string') return value.length * 2; // UTF-16\r\n\r\n  if (value instanceof ArrayBuffer) return value.byteLength;\r\n  if (ArrayBuffer.isView(value)) return value.byteLength;\r\n  if (value instanceof Blob) return value.size;\r\n\r\n  const seen = new WeakSet<object>();\r\n\r\n  function traverse(obj: unknown): number {\r\n    if (obj === null || typeof obj !== 'object') {\r\n      if (typeof obj === 'boolean') return 4;\r\n      if (typeof obj === 'number') return 8;\r\n      if (typeof obj === 'string') return (obj as string).length * 2;\r\n      return 0;\r\n    }\r\n\r\n    if (seen.has(obj)) return 0; // Avoid infinite loops\r\n    seen.add(obj);\r\n\r\n    if (obj instanceof ArrayBuffer) return obj.byteLength;\r\n    if (ArrayBuffer.isView(obj)) return obj.byteLength;\r\n    if (obj instanceof Blob) return obj.size;\r\n    if (obj instanceof Date) return 8;\r\n    if (obj instanceof RegExp) return obj.source.length * 2;\r\n\r\n    if (Array.isArray(obj)) {\r\n      return obj.reduce((sum, item) => sum + traverse(item), 0);\r\n    }\r\n\r\n    if (obj instanceof Map) {\r\n      let size = 0;\r\n      obj.forEach((val, key) => {\r\n        size += traverse(key) + traverse(val);\r\n      });\r\n      return size;\r\n    }\r\n\r\n    if (obj instanceof Set) {\r\n      let size = 0;\r\n      obj.forEach((val) => {\r\n        size += traverse(val);\r\n      });\r\n      return size;\r\n    }\r\n\r\n    // Plain object\r\n    return Object.entries(obj).reduce(\r\n      (sum, [key, val]) => sum + key.length * 2 + traverse(val),\r\n      0\r\n    );\r\n  }\r\n\r\n  return traverse(value);\r\n}\r\n\r\n/**\r\n * Format bytes to human-readable string\r\n */\r\nexport function formatBytes(bytes: number): string {\r\n  if (bytes === 0) return '0 B';\r\n  const k = 1024;\r\n  const sizes = ['B', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return `${(bytes / Math.pow(k, i)).toFixed(i > 0 ? 1 : 0)} ${sizes[i]}`;\r\n}\r\n\r\n/**\r\n * Logger utility\r\n */\r\nexport interface Logger {\r\n  debug(...args: unknown[]): void;\r\n  info(...args: unknown[]): void;\r\n  warn(...args: unknown[]): void;\r\n  error(...args: unknown[]): void;\r\n}\r\n\r\nexport function createLogger(prefix: string, enabled: boolean = false): Logger {\r\n  const noop = () => {};\r\n  const log = (level: string) =>\r\n    enabled ? (...args: unknown[]) => console.log(`[${prefix}:${level}]`, ...args) : noop;\r\n\r\n  return {\r\n    debug: log('debug'),\r\n    info: log('info'),\r\n    warn: enabled\r\n      ? (...args: unknown[]) => console.warn(`[${prefix}:warn]`, ...args)\r\n      : noop,\r\n    error: (...args: unknown[]) => console.error(`[${prefix}:error]`, ...args),\r\n  };\r\n}\r\n","/**\r\n * ComputeKit Worker Pool\r\n * Manages a pool of Web Workers for parallel computation\r\n */\r\n\r\nimport type {\r\n  ComputeKitOptions,\r\n  ComputeOptions,\r\n  ComputeProgress,\r\n  WorkerInfo,\r\n  WorkerState,\r\n  PoolStats,\r\n  WorkerMessage,\r\n  ExecutePayload,\r\n  ResultPayload,\r\n  ErrorPayload,\r\n  ProgressPayload,\r\n} from './types';\r\n\r\nimport {\r\n  generateId,\r\n  createDeferred,\r\n  withTimeout,\r\n  findTransferables,\r\n  getHardwareConcurrency,\r\n  createLogger,\r\n  estimatePayloadSize,\r\n  formatBytes,\r\n  type Deferred,\r\n  type Logger,\r\n} from './utils';\r\n\r\n/** Task in the queue */\r\ninterface QueuedTask<T = unknown> {\r\n  id: string;\r\n  functionName: string;\r\n  input: unknown;\r\n  options?: ComputeOptions;\r\n  deferred: Deferred<T>;\r\n  priority: number;\r\n  createdAt: number;\r\n  onProgress?: (progress: ComputeProgress) => void;\r\n}\r\n\r\n/** Worker wrapper */\r\ninterface PoolWorker {\r\n  id: string;\r\n  worker: Worker;\r\n  state: WorkerState;\r\n  currentTask?: string;\r\n  tasksCompleted: number;\r\n  errors: number;\r\n  createdAt: number;\r\n  lastActiveAt: number;\r\n  ready: boolean;\r\n  readyPromise: Promise<void>;\r\n}\r\n\r\n/** Registry entry for compute functions */\r\ninterface RegisteredFunction {\r\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\r\n  fn: Function;\r\n  serialized: string;\r\n}\r\n\r\n/**\r\n * Worker Pool - manages Web Workers for parallel computation\r\n */\r\nexport class WorkerPool {\r\n  private workers: Map<string, PoolWorker> = new Map();\r\n  private taskQueue: QueuedTask[] = [];\r\n  private pendingTasks: Map<string, QueuedTask> = new Map();\r\n  private functions: Map<string, RegisteredFunction> = new Map();\r\n  private workerUrl: string | null = null;\r\n  private options: Required<ComputeKitOptions>;\r\n  private logger: Logger;\r\n  private initialized = false;\r\n  private stats = {\r\n    tasksCompleted: 0,\r\n    tasksFailed: 0,\r\n    totalDuration: 0,\r\n  };\r\n\r\n  constructor(options: ComputeKitOptions = {}) {\r\n    this.options = {\r\n      maxWorkers: options.maxWorkers ?? getHardwareConcurrency(),\r\n      timeout: options.timeout ?? 30000,\r\n      debug: options.debug ?? false,\r\n      workerPath: options.workerPath ?? '',\r\n      useSharedMemory: options.useSharedMemory ?? true,\r\n      remoteDependencies: options.remoteDependencies ?? [],\r\n      remoteDependencyNames: options.remoteDependencyNames ?? {},\r\n    };\r\n\r\n    this.logger = createLogger('ComputeKit:Pool', this.options.debug);\r\n    this.logger.info('WorkerPool created with options:', this.options);\r\n  }\r\n\r\n  /**\r\n   * Initialize the worker pool\r\n   */\r\n  async initialize(): Promise<void> {\r\n    if (this.initialized) return;\r\n\r\n    this.logger.info('Initializing worker pool...');\r\n    this.logger.info('Registered functions:', Array.from(this.functions.keys()));\r\n    this.workerUrl = this.createWorkerBlob();\r\n\r\n    // Create initial workers\r\n    const workerCount = Math.min(2, this.options.maxWorkers);\r\n    for (let i = 0; i < workerCount; i++) {\r\n      await this.createWorker();\r\n    }\r\n\r\n    this.initialized = true;\r\n    this.logger.info(`Worker pool initialized with ${workerCount} workers`);\r\n  }\r\n\r\n  private pendingRecreate: Promise<void> | null = null;\r\n\r\n  /**\r\n   * Register a compute function\r\n   */\r\n  register<TInput, TOutput>(\r\n    name: string,\r\n    fn: (input: TInput) => TOutput | Promise<TOutput>\r\n  ): void {\r\n    this.logger.debug(`Registering function: ${name}`);\r\n    this.functions.set(name, {\r\n      fn,\r\n      serialized: fn.toString(),\r\n    });\r\n\r\n    // If already initialized, we need to recreate workers with updated functions\r\n    if (this.initialized) {\r\n      this.pendingRecreate = this.recreateWorkers();\r\n    } else {\r\n      // If not initialized yet but workerUrl exists, revoke it so it gets recreated\r\n      if (this.workerUrl) {\r\n        URL.revokeObjectURL(this.workerUrl);\r\n        this.workerUrl = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Recreate workers with updated function registry\r\n   */\r\n  private async recreateWorkers(): Promise<void> {\r\n    this.logger.debug('Recreating workers with updated functions...');\r\n\r\n    // Revoke old blob URL\r\n    if (this.workerUrl) {\r\n      URL.revokeObjectURL(this.workerUrl);\r\n    }\r\n\r\n    // Create new worker blob with all functions\r\n    this.workerUrl = this.createWorkerBlob();\r\n\r\n    // Terminate existing idle workers and create new ones\r\n    const idleWorkers = Array.from(this.workers.entries()).filter(\r\n      ([_, w]) => w.state === 'idle'\r\n    );\r\n\r\n    for (const [id, poolWorker] of idleWorkers) {\r\n      poolWorker.worker.terminate();\r\n      this.workers.delete(id);\r\n    }\r\n\r\n    // Create new workers\r\n    const workerCount = Math.max(\r\n      1,\r\n      Math.min(2, this.options.maxWorkers) - this.workers.size\r\n    );\r\n    for (let i = 0; i < workerCount; i++) {\r\n      await this.createWorker();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute a compute function\r\n   */\r\n  async execute<TInput, TOutput>(\r\n    name: string,\r\n    input: TInput,\r\n    options?: ComputeOptions\r\n  ): Promise<TOutput> {\r\n    // Wait for any pending worker recreation\r\n    if (this.pendingRecreate) {\r\n      await this.pendingRecreate;\r\n      this.pendingRecreate = null;\r\n    }\r\n\r\n    if (!this.initialized) {\r\n      await this.initialize();\r\n    }\r\n\r\n    const fn = this.functions.get(name);\r\n    if (!fn) {\r\n      throw new Error(`Function \"${name}\" not registered`);\r\n    }\r\n\r\n    const taskId = generateId();\r\n    const timeout = options?.timeout ?? this.options.timeout;\r\n\r\n    this.logger.debug(`Executing task ${taskId} for function \"${name}\"`);\r\n\r\n    // Check for abort signal\r\n    if (options?.signal?.aborted) {\r\n      throw new Error('Operation aborted');\r\n    }\r\n\r\n    const deferred = createDeferred<TOutput>();\r\n    const task: QueuedTask<TOutput> = {\r\n      id: taskId,\r\n      functionName: name,\r\n      input,\r\n      options,\r\n      deferred,\r\n      priority: options?.priority ?? 5,\r\n      createdAt: Date.now(),\r\n      onProgress: options?.onProgress,\r\n    };\r\n\r\n    // Handle abort signal\r\n    if (options?.signal) {\r\n      options.signal.addEventListener('abort', () => {\r\n        this.cancelTask(taskId);\r\n        deferred.reject(new Error('Operation aborted'));\r\n      });\r\n    }\r\n\r\n    // Add to queue\r\n    this.enqueue(task);\r\n    this.processQueue();\r\n\r\n    return withTimeout(deferred.promise, timeout, `Task \"${name}\" timed out`);\r\n  }\r\n\r\n  /**\r\n   * Get pool statistics\r\n   */\r\n  getStats(): PoolStats {\r\n    const workers = Array.from(this.workers.values()).map(\r\n      (w): WorkerInfo => ({\r\n        id: w.id,\r\n        state: w.state,\r\n        currentTask: w.currentTask,\r\n        tasksCompleted: w.tasksCompleted,\r\n        errors: w.errors,\r\n        createdAt: w.createdAt,\r\n        lastActiveAt: w.lastActiveAt,\r\n      })\r\n    );\r\n\r\n    return {\r\n      workers,\r\n      totalWorkers: this.workers.size,\r\n      activeWorkers: workers.filter((w) => w.state === 'busy').length,\r\n      idleWorkers: workers.filter((w) => w.state === 'idle').length,\r\n      queueLength: this.taskQueue.length,\r\n      tasksCompleted: this.stats.tasksCompleted,\r\n      tasksFailed: this.stats.tasksFailed,\r\n      averageTaskDuration:\r\n        this.stats.tasksCompleted > 0\r\n          ? this.stats.totalDuration / this.stats.tasksCompleted\r\n          : 0,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Terminate all workers and clean up\r\n   */\r\n  async terminate(): Promise<void> {\r\n    this.logger.info('Terminating worker pool...');\r\n\r\n    // Reject all pending tasks\r\n    for (const task of this.pendingTasks.values()) {\r\n      task.deferred.reject(new Error('Worker pool terminated'));\r\n    }\r\n    this.pendingTasks.clear();\r\n    this.taskQueue = [];\r\n\r\n    // Terminate all workers\r\n    for (const poolWorker of this.workers.values()) {\r\n      poolWorker.worker.terminate();\r\n      poolWorker.state = 'terminated';\r\n    }\r\n    this.workers.clear();\r\n\r\n    // Revoke blob URL\r\n    if (this.workerUrl) {\r\n      URL.revokeObjectURL(this.workerUrl);\r\n      this.workerUrl = null;\r\n    }\r\n\r\n    this.initialized = false;\r\n    this.logger.info('Worker pool terminated');\r\n  }\r\n\r\n  /**\r\n   * Create the worker blob URL\r\n   */\r\n  private createWorkerBlob(): string {\r\n    // Serialize all registered functions\r\n    const functionsCode = Array.from(this.functions.entries())\r\n      .map(([name, { serialized }]) => `\"${name}\": ${serialized}`)\r\n      .join(',\\n');\r\n\r\n    this.logger.debug(\r\n      'Creating worker blob with functions:',\r\n      Array.from(this.functions.keys())\r\n    );\r\n\r\n    // Generate importScripts for remote dependencies\r\n    const remoteDeps = this.options.remoteDependencies;\r\n    const importScriptsCode =\r\n      remoteDeps.length > 0\r\n        ? `importScripts(${remoteDeps.map((url) => `\"${url}\"`).join(', ')});`\r\n        : '';\r\n\r\n    // Generate alias assignments for remote dependencies to handle obfuscated names in production\r\n    // This allows the worker to access third-party libraries under their obfuscated names if needed\r\n    const dependencyAliases = this.options.remoteDependencyNames;\r\n    let aliasCode = '';\r\n    \r\n    if (Object.keys(dependencyAliases).length > 0) {\r\n      const aliases: string[] = [];\r\n      for (const [url, varName] of Object.entries(dependencyAliases)) {\r\n        // Try to extract the global variable name that will be created by the library\r\n        const globalName = this.extractGlobalNameFromUrl(url);\r\n        if (globalName && globalName !== varName) {\r\n          // Create an alias from the detected global name to the specified varName\r\n          // This handles cases where the library name differs from the import name in obfuscated code\r\n          aliases.push(\r\n            `if (typeof ${globalName} !== 'undefined' && typeof self.${varName} === 'undefined') {` +\r\n            ` self.${varName} = ${globalName}; ` +\r\n            `}`\r\n          );\r\n        }\r\n      }\r\n      aliasCode = aliases.join('\\n');\r\n    }\r\n\r\n    const workerCode = `\r\n${importScriptsCode}\r\n\r\n// Create aliases for obfuscated names in production builds\r\n${aliasCode}\r\n\r\nconst functions = {\r\n${functionsCode}\r\n};\r\n\r\nself.onmessage = function(e) {\r\n  const msg = e.data;\r\n  if (msg.type === 'execute') {\r\n    const fn = functions[msg.payload.functionName];\r\n    if (!fn) {\r\n      self.postMessage({ id: msg.id, type: 'error', payload: { message: 'Function not found: ' + msg.payload.functionName } });\r\n      return;\r\n    }\r\n    try {\r\n      const start = performance.now();\r\n      Promise.resolve(fn(msg.payload.input)).then(function(result) {\r\n        self.postMessage({ id: msg.id, type: 'result', payload: { data: result, duration: performance.now() - start } });\r\n      }).catch(function(err) {\r\n        self.postMessage({ id: msg.id, type: 'error', payload: { message: err.message || String(err) } });\r\n      });\r\n    } catch (err) {\r\n      self.postMessage({ id: msg.id, type: 'error', payload: { message: err.message || String(err) } });\r\n    }\r\n  }\r\n};\r\nself.postMessage({ type: 'ready' });\r\n`;\r\n\r\n    const blob = new Blob([workerCode], { type: 'application/javascript' });\r\n    return URL.createObjectURL(blob);\r\n  }\r\n\r\n  /**\r\n   * Extract the likely global variable name from a URL\r\n   * e.g., \"https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.18/dayjs.min.js\" -> \"dayjs\"\r\n   */\r\n  private extractGlobalNameFromUrl(url: string): string | null {\r\n    try {\r\n      const pathname = new URL(url).pathname;\r\n      const filename = pathname.split('/').pop() || '';\r\n      // Remove common suffixes: .min.js, .js, .min.mjs, .mjs\r\n      const bareFilename = filename\r\n        .replace(/\\.min\\.(js|mjs)$/, '')\r\n        .replace(/\\.(js|mjs)$/, '');\r\n      return bareFilename || null;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a new worker\r\n   */\r\n  private async createWorker(): Promise<PoolWorker> {\r\n    if (!this.workerUrl) {\r\n      this.workerUrl = this.createWorkerBlob();\r\n    }\r\n\r\n    const id = generateId();\r\n    const worker = new Worker(this.workerUrl);\r\n\r\n    // Create ready promise\r\n    let resolveReady: () => void;\r\n    const readyPromise = new Promise<void>((resolve) => {\r\n      resolveReady = resolve;\r\n    });\r\n\r\n    const poolWorker: PoolWorker = {\r\n      id,\r\n      worker,\r\n      state: 'idle',\r\n      tasksCompleted: 0,\r\n      errors: 0,\r\n      createdAt: Date.now(),\r\n      lastActiveAt: Date.now(),\r\n      ready: false,\r\n      readyPromise,\r\n    };\r\n\r\n    // Set up message handler\r\n    worker.onmessage = (e: MessageEvent<WorkerMessage>) => {\r\n      if (e.data.type === 'ready') {\r\n        poolWorker.ready = true;\r\n        resolveReady!();\r\n      }\r\n      this.handleWorkerMessage(poolWorker, e.data);\r\n    };\r\n\r\n    worker.onerror = (e: ErrorEvent) => {\r\n      this.handleWorkerError(poolWorker, e);\r\n    };\r\n\r\n    this.workers.set(id, poolWorker);\r\n    this.logger.debug(`Created worker ${id}`);\r\n\r\n    // Wait for worker to be ready\r\n    await readyPromise;\r\n    this.logger.debug(`Worker ${id} is ready`);\r\n\r\n    return poolWorker;\r\n  }\r\n\r\n  /**\r\n   * Handle messages from workers\r\n   */\r\n  private handleWorkerMessage(poolWorker: PoolWorker, message: WorkerMessage): void {\r\n    this.logger.debug('Received message from worker:', message);\r\n    const { id, type, payload } = message;\r\n\r\n    switch (type) {\r\n      case 'ready':\r\n        this.logger.debug(`Worker ${poolWorker.id} ready`);\r\n        break;\r\n\r\n      case 'result': {\r\n        const task = this.pendingTasks.get(id);\r\n        if (task) {\r\n          const resultPayload = payload as ResultPayload;\r\n          this.pendingTasks.delete(id);\r\n          poolWorker.state = 'idle';\r\n          poolWorker.currentTask = undefined;\r\n          poolWorker.tasksCompleted++;\r\n          poolWorker.lastActiveAt = Date.now();\r\n\r\n          this.stats.tasksCompleted++;\r\n          this.stats.totalDuration += resultPayload.duration;\r\n\r\n          // Log with payload sizes in debug mode\r\n          const inputSize = estimatePayloadSize(task.input);\r\n          const outputSize = resultPayload.outputSize ?? 0;\r\n          this.logger.debug(\r\n            `Task ${id} (${task.functionName}): ` +\r\n              `input=${formatBytes(inputSize)}, ` +\r\n              `output=${formatBytes(outputSize)}, ` +\r\n              `duration=${resultPayload.duration.toFixed(2)}ms`\r\n          );\r\n          task.deferred.resolve(resultPayload.data);\r\n\r\n          // Process next task\r\n          this.processQueue();\r\n        }\r\n        break;\r\n      }\r\n\r\n      case 'error': {\r\n        const task = this.pendingTasks.get(id);\r\n        if (task) {\r\n          const errorPayload = payload as ErrorPayload;\r\n          this.pendingTasks.delete(id);\r\n          poolWorker.state = 'idle';\r\n          poolWorker.currentTask = undefined;\r\n          poolWorker.errors++;\r\n          poolWorker.lastActiveAt = Date.now();\r\n\r\n          this.stats.tasksFailed++;\r\n\r\n          const error = new Error(errorPayload.message);\r\n          if (errorPayload.stack) {\r\n            error.stack = errorPayload.stack;\r\n          }\r\n\r\n          this.logger.error(`Task ${id} failed:`, errorPayload.message);\r\n          task.deferred.reject(error);\r\n\r\n          // Process next task\r\n          this.processQueue();\r\n        }\r\n        break;\r\n      }\r\n\r\n      case 'progress': {\r\n        const progressPayload = payload as ProgressPayload;\r\n        const task = this.pendingTasks.get(progressPayload.taskId);\r\n        if (task?.onProgress) {\r\n          task.onProgress(progressPayload.progress);\r\n        }\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle worker errors\r\n   */\r\n  private handleWorkerError(poolWorker: PoolWorker, error: ErrorEvent): void {\r\n    this.logger.error(`Worker ${poolWorker.id} error:`, error.message);\r\n    poolWorker.state = 'error';\r\n    poolWorker.errors++;\r\n\r\n    // Reject current task if any\r\n    if (poolWorker.currentTask) {\r\n      const task = this.pendingTasks.get(poolWorker.currentTask);\r\n      if (task) {\r\n        this.pendingTasks.delete(poolWorker.currentTask);\r\n        task.deferred.reject(new Error(`Worker error: ${error.message}`));\r\n      }\r\n    }\r\n\r\n    // Terminate and recreate the worker\r\n    poolWorker.worker.terminate();\r\n    this.workers.delete(poolWorker.id);\r\n\r\n    // Create a new worker to replace it\r\n    this.createWorker().then(() => this.processQueue());\r\n  }\r\n\r\n  /**\r\n   * Add task to queue (priority-based)\r\n   */\r\n  private enqueue<T>(task: QueuedTask<T>): void {\r\n    // Insert based on priority (higher priority first)\r\n    let inserted = false;\r\n    for (let i = 0; i < this.taskQueue.length; i++) {\r\n      if (task.priority > this.taskQueue[i].priority) {\r\n        this.taskQueue.splice(i, 0, task as QueuedTask);\r\n        inserted = true;\r\n        break;\r\n      }\r\n    }\r\n    if (!inserted) {\r\n      this.taskQueue.push(task as QueuedTask);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Process queued tasks\r\n   */\r\n  private async processQueue(): Promise<void> {\r\n    if (this.taskQueue.length === 0) return;\r\n\r\n    // Find an idle worker\r\n    let idleWorker: PoolWorker | undefined;\r\n    for (const worker of this.workers.values()) {\r\n      if (worker.state === 'idle') {\r\n        idleWorker = worker;\r\n        break;\r\n      }\r\n    }\r\n\r\n    // Create new worker if needed and under limit\r\n    if (!idleWorker && this.workers.size < this.options.maxWorkers) {\r\n      idleWorker = await this.createWorker();\r\n    }\r\n\r\n    if (!idleWorker) return;\r\n\r\n    // Get next task\r\n    const task = this.taskQueue.shift();\r\n    if (!task) return;\r\n\r\n    // Execute task\r\n    this.executeOnWorker(idleWorker, task);\r\n\r\n    // Continue processing if more tasks\r\n    if (this.taskQueue.length > 0) {\r\n      this.processQueue();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Execute task on a specific worker\r\n   */\r\n  private executeOnWorker(poolWorker: PoolWorker, task: QueuedTask): void {\r\n    this.logger.debug(\r\n      `executeOnWorker: Starting task ${task.id} (${task.functionName}) on worker ${poolWorker.id}`\r\n    );\r\n    poolWorker.state = 'busy';\r\n    poolWorker.currentTask = task.id;\r\n    poolWorker.lastActiveAt = Date.now();\r\n\r\n    this.pendingTasks.set(task.id, task);\r\n\r\n    const message: WorkerMessage<ExecutePayload> = {\r\n      id: task.id,\r\n      type: 'execute',\r\n      payload: {\r\n        functionName: task.functionName,\r\n        input: task.input,\r\n        // Don't send options - they may contain non-cloneable objects like AbortSignal\r\n      },\r\n      timestamp: Date.now(),\r\n    };\r\n\r\n    // Find transferables in input\r\n    const transfer = findTransferables(task.input);\r\n\r\n    this.logger.debug(`Posting message to worker:`, message);\r\n    poolWorker.worker.postMessage(message, transfer);\r\n    this.logger.debug(`Message posted to worker ${poolWorker.id}`);\r\n  }\r\n\r\n  /**\r\n   * Cancel a pending task\r\n   */\r\n  private cancelTask(taskId: string): void {\r\n    // Remove from queue\r\n    const queueIndex = this.taskQueue.findIndex((t) => t.id === taskId);\r\n    if (queueIndex !== -1) {\r\n      this.taskQueue.splice(queueIndex, 1);\r\n    }\r\n\r\n    // Remove from pending (worker will complete but result ignored)\r\n    this.pendingTasks.delete(taskId);\r\n  }\r\n}\r\n","/**\r\n * ComputeKit WASM Loader\r\n * Utilities for loading and managing WebAssembly modules\r\n */\r\n\r\nimport type { WasmModuleConfig } from './types';\r\nimport { createLogger, LRUCache } from './utils';\r\n\r\nconst logger = createLogger('ComputeKit:WASM');\r\n\r\n/** Cached WASM modules */\r\nconst moduleCache = new LRUCache<string, WebAssembly.Module>(10);\r\n\r\n/** Cached WASM instances */\r\nconst instanceCache = new LRUCache<string, WebAssembly.Instance>(10);\r\n\r\n/**\r\n * Load a WASM module from various sources\r\n */\r\nexport async function loadWasmModule(\r\n  source: string | ArrayBuffer | Uint8Array\r\n): Promise<WebAssembly.Module> {\r\n  // Check cache for string sources\r\n  if (typeof source === 'string') {\r\n    const cached = moduleCache.get(source);\r\n    if (cached) {\r\n      logger.debug('Using cached WASM module:', source);\r\n      return cached;\r\n    }\r\n  }\r\n\r\n  let bytes: ArrayBuffer | Uint8Array;\r\n\r\n  if (typeof source === 'string') {\r\n    if (source.startsWith('data:')) {\r\n      // Base64 encoded WASM\r\n      const base64 = source.split(',')[1];\r\n      bytes = Uint8Array.from(atob(base64), (c) => c.charCodeAt(0));\r\n    } else {\r\n      // URL to WASM file\r\n      logger.debug('Fetching WASM from:', source);\r\n      const response = await fetch(source);\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Failed to fetch WASM: ${response.statusText}`);\r\n      }\r\n\r\n      // Use streaming compilation if available\r\n      if (WebAssembly.compileStreaming) {\r\n        const module = await WebAssembly.compileStreaming(response);\r\n        moduleCache.set(source, module);\r\n        return module;\r\n      }\r\n\r\n      bytes = await response.arrayBuffer();\r\n    }\r\n  } else {\r\n    bytes = source;\r\n  }\r\n\r\n  // Compile the module\r\n  const module = await WebAssembly.compile(bytes as BufferSource);\r\n\r\n  if (typeof source === 'string') {\r\n    moduleCache.set(source, module);\r\n  }\r\n\r\n  return module;\r\n}\r\n\r\n/**\r\n * Instantiate a WASM module with imports\r\n */\r\nexport async function instantiateWasm(\r\n  module: WebAssembly.Module,\r\n  imports: WebAssembly.Imports = {}\r\n): Promise<WebAssembly.Instance> {\r\n  return WebAssembly.instantiate(module, imports);\r\n}\r\n\r\n/**\r\n * Load and instantiate a WASM module in one step\r\n */\r\nexport async function loadAndInstantiate(\r\n  config: WasmModuleConfig\r\n): Promise<{ module: WebAssembly.Module; instance: WebAssembly.Instance }> {\r\n  const { source, imports = {}, memory } = config;\r\n\r\n  // Create memory if specified\r\n  const wasmImports: WebAssembly.Imports = { ...imports };\r\n  if (memory) {\r\n    wasmImports.env = {\r\n      ...wasmImports.env,\r\n      memory: new WebAssembly.Memory({\r\n        initial: memory.initial,\r\n        maximum: memory.maximum,\r\n        shared: memory.shared,\r\n      }),\r\n    };\r\n  }\r\n\r\n  const module = await loadWasmModule(source);\r\n  const instance = await instantiateWasm(module, wasmImports);\r\n\r\n  return { module, instance };\r\n}\r\n\r\n/**\r\n * Create a WASM module from AssemblyScript-compiled bytes\r\n */\r\nexport async function loadAssemblyScript(\r\n  source: string | ArrayBuffer,\r\n  imports: WebAssembly.Imports = {}\r\n): Promise<{\r\n  module: WebAssembly.Module;\r\n  instance: WebAssembly.Instance;\r\n  exports: Record<string, unknown>;\r\n}> {\r\n  // Default AssemblyScript imports\r\n  const defaultImports: WebAssembly.Imports = {\r\n    env: {\r\n      abort: (_message: number, fileName: number, line: number, column: number) => {\r\n        console.error(`AssemblyScript abort at ${fileName}:${line}:${column}`);\r\n      },\r\n      seed: () => Date.now(),\r\n      ...((imports.env as object) || {}),\r\n    },\r\n    ...imports,\r\n  };\r\n\r\n  const { module, instance } = await loadAndInstantiate({\r\n    source,\r\n    imports: defaultImports,\r\n  });\r\n\r\n  return {\r\n    module,\r\n    instance,\r\n    exports: instance.exports as Record<string, unknown>,\r\n  };\r\n}\r\n\r\n/**\r\n * Helper to wrap WASM exports for easier use\r\n */\r\nexport function wrapWasmExports<T extends Record<string, unknown>>(\r\n  instance: WebAssembly.Instance\r\n): T {\r\n  return instance.exports as T;\r\n}\r\n\r\n/**\r\n * Create a typed array view into WASM memory\r\n */\r\nexport function getMemoryView<T extends ArrayBufferView>(\r\n  memory: WebAssembly.Memory,\r\n  ArrayType: new (buffer: ArrayBuffer, byteOffset?: number, length?: number) => T,\r\n  offset: number = 0,\r\n  length?: number\r\n): T {\r\n  return new ArrayType(memory.buffer, offset, length);\r\n}\r\n\r\n/**\r\n * Copy data to WASM memory\r\n */\r\nexport function copyToWasmMemory(\r\n  memory: WebAssembly.Memory,\r\n  data: ArrayBufferView,\r\n  offset: number\r\n): void {\r\n  const view = new Uint8Array(memory.buffer);\r\n  const source = new Uint8Array(data.buffer, data.byteOffset, data.byteLength);\r\n  view.set(source, offset);\r\n}\r\n\r\n/**\r\n * Copy data from WASM memory\r\n */\r\nexport function copyFromWasmMemory(\r\n  memory: WebAssembly.Memory,\r\n  offset: number,\r\n  length: number\r\n): Uint8Array {\r\n  const view = new Uint8Array(memory.buffer, offset, length);\r\n  return new Uint8Array(view); // Copy to detach from WASM memory\r\n}\r\n\r\n/**\r\n * Clear module caches\r\n */\r\nexport function clearWasmCache(): void {\r\n  moduleCache.clear();\r\n  instanceCache.clear();\r\n}\r\n\r\n/**\r\n * Get cache statistics\r\n */\r\nexport function getWasmCacheStats(): { modules: number; instances: number } {\r\n  return {\r\n    modules: moduleCache.size,\r\n    instances: instanceCache.size,\r\n  };\r\n}\r\n","/**\r\n * ComputeKit - Main Entry Point\r\n * WASM + Worker toolkit for React & Web apps\r\n */\r\n\r\nimport type {\r\n  ComputeKitOptions,\r\n  ComputeOptions,\r\n  ComputeResult,\r\n  PoolStats,\r\n  ComputeKitEvents,\r\n} from './types';\r\n\r\nimport type {\r\n  ComputeFunctionRegistry,\r\n  RegisteredFunctionName,\r\n  FunctionInput,\r\n  FunctionOutput,\r\n  ComputeFn,\r\n} from './registry';\r\n\r\nimport { WorkerPool } from './pool';\r\nimport { EventEmitter, isWasmSupported, createLogger } from './utils';\r\n\r\nconst logger = createLogger('ComputeKit');\r\n\r\n/**\r\n * ComputeKit - The main class for managing compute operations\r\n *\r\n * @example\r\n * ```ts\r\n * import { ComputeKit } from '@computekit/core';\r\n *\r\n * const kit = new ComputeKit();\r\n *\r\n * // Register a compute function\r\n * kit.register('fibonacci', (n: number) => {\r\n *   if (n <= 1) return n;\r\n *   let a = 0, b = 1;\r\n *   for (let i = 2; i <= n; i++) {\r\n *     [a, b] = [b, a + b];\r\n *   }\r\n *   return b;\r\n * });\r\n *\r\n * // Execute the function\r\n * const result = await kit.run('fibonacci', 50);\r\n * console.log(result); // 12586269025\r\n * ```\r\n */\r\nexport class ComputeKit extends EventEmitter<ComputeKitEvents> {\r\n  private pool: WorkerPool;\r\n\r\n  constructor(options: ComputeKitOptions = {}) {\r\n    super();\r\n    this.pool = new WorkerPool(options);\r\n    logger.debug('ComputeKit initialized', options);\r\n  }\r\n\r\n  /**\r\n   * Initialize ComputeKit\r\n   * Called automatically on first run, but can be called manually for eager initialization\r\n   */\r\n  async initialize(): Promise<void> {\r\n    await this.pool.initialize();\r\n  }\r\n\r\n  /**\r\n   * Register a compute function\r\n   *\r\n   * @param name - Unique name for the function (autocompletes if registry is extended)\r\n   * @param fn - The function to execute (will run in a Web Worker)\r\n   *\r\n   * @example\r\n   * ```ts\r\n   * // Basic usage\r\n   * kit.register('sum', (arr: number[]) => arr.reduce((a, b) => a + b, 0));\r\n   *\r\n   * // With typed registry (extend ComputeFunctionRegistry for autocomplete)\r\n   * // declare module '@computekit/core' {\r\n   * //   interface ComputeFunctionRegistry {\r\n   * //     sum: { input: number[]; output: number };\r\n   * //   }\r\n   * // }\r\n   * // kit.register('sum', (arr) => arr.reduce((a, b) => a + b, 0));\r\n   * ```\r\n   */\r\n  register<\r\n    TName extends RegisteredFunctionName,\r\n    TInput = FunctionInput<TName extends string ? TName : never>,\r\n    TOutput = FunctionOutput<TName extends string ? TName : never>,\r\n  >(\r\n    name: TName,\r\n    fn: TName extends keyof ComputeFunctionRegistry\r\n      ? ComputeFn<\r\n          ComputeFunctionRegistry[TName]['input'],\r\n          ComputeFunctionRegistry[TName]['output']\r\n        >\r\n      : ComputeFn<TInput, TOutput>\r\n  ): this {\r\n    this.pool.register(name as string, fn as ComputeFn<unknown, unknown>);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Execute a registered compute function\r\n   *\r\n   * @param name - Name of the registered function (autocompletes if registry is extended)\r\n   * @param input - Input data for the function (type-safe if registry is extended)\r\n   * @param options - Execution options\r\n   * @returns Promise resolving to the function result (type-safe if registry is extended)\r\n   *\r\n   * @example\r\n   * ```ts\r\n   * const sum = await kit.run('sum', [1, 2, 3, 4, 5]);\r\n   *\r\n   * // With typed registry, input/output types are inferred:\r\n   * // const result = await kit.run('fibonacci', 50); // result: number\r\n   * ```\r\n   */\r\n  async run<\r\n    TName extends RegisteredFunctionName,\r\n    TInput = FunctionInput<TName extends string ? TName : never>,\r\n    TOutput = FunctionOutput<TName extends string ? TName : never>,\r\n  >(\r\n    name: TName,\r\n    input: TName extends keyof ComputeFunctionRegistry\r\n      ? ComputeFunctionRegistry[TName]['input']\r\n      : TInput,\r\n    options?: ComputeOptions\r\n  ): Promise<\r\n    TName extends keyof ComputeFunctionRegistry\r\n      ? ComputeFunctionRegistry[TName]['output']\r\n      : TOutput\r\n  > {\r\n    return this.pool.execute(name as string, input, options);\r\n  }\r\n\r\n  /**\r\n   * Execute a registered compute function with full result metadata\r\n   *\r\n   * @param name - Name of the registered function (autocompletes if registry is extended)\r\n   * @param input - Input data for the function (type-safe if registry is extended)\r\n   * @param options - Execution options\r\n   * @returns Promise resolving to ComputeResult with metadata\r\n   *\r\n   * @example\r\n   * ```ts\r\n   * const result = await kit.runWithMetadata('sum', data);\r\n   * console.log(`Took ${result.duration}ms`);\r\n   * ```\r\n   */\r\n  async runWithMetadata<\r\n    TName extends RegisteredFunctionName,\r\n    TInput = FunctionInput<TName extends string ? TName : never>,\r\n    TOutput = FunctionOutput<TName extends string ? TName : never>,\r\n  >(\r\n    name: TName,\r\n    input: TName extends keyof ComputeFunctionRegistry\r\n      ? ComputeFunctionRegistry[TName]['input']\r\n      : TInput,\r\n    options?: ComputeOptions\r\n  ): Promise<\r\n    ComputeResult<\r\n      TName extends keyof ComputeFunctionRegistry\r\n        ? ComputeFunctionRegistry[TName]['output']\r\n        : TOutput\r\n    >\r\n  > {\r\n    type ActualOutput = TName extends keyof ComputeFunctionRegistry\r\n      ? ComputeFunctionRegistry[TName]['output']\r\n      : TOutput;\r\n\r\n    const startTime = performance.now();\r\n    const data = (await this.pool.execute(\r\n      name as string,\r\n      input,\r\n      options\r\n    )) as ActualOutput;\r\n    const duration = performance.now() - startTime;\r\n\r\n    return {\r\n      data,\r\n      duration,\r\n      cached: false,\r\n      workerId: 'unknown', // Would need pool changes to track this\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get pool statistics\r\n   */\r\n  getStats(): PoolStats {\r\n    return this.pool.getStats();\r\n  }\r\n\r\n  /**\r\n   * Check if WebAssembly is supported\r\n   */\r\n  isWasmSupported(): boolean {\r\n    return isWasmSupported();\r\n  }\r\n\r\n  /**\r\n   * Terminate the worker pool and clean up resources\r\n   */\r\n  async terminate(): Promise<void> {\r\n    await this.pool.terminate();\r\n    this.removeAllListeners();\r\n  }\r\n}\r\n\r\n/**\r\n * Create a pre-configured ComputeKit instance\r\n */\r\nexport function createComputeKit(options?: ComputeKitOptions): ComputeKit {\r\n  return new ComputeKit(options);\r\n}\r\n\r\n/**\r\n * Default shared instance\r\n */\r\nlet defaultInstance: ComputeKit | null = null;\r\n\r\n/**\r\n * Get the default shared ComputeKit instance\r\n */\r\nexport function getDefaultInstance(): ComputeKit {\r\n  if (!defaultInstance) {\r\n    defaultInstance = new ComputeKit();\r\n  }\r\n  return defaultInstance;\r\n}\r\n\r\n/**\r\n * Register a function on the default instance\r\n *\r\n * @example\r\n * ```ts\r\n * import { register } from '@computekit/core';\r\n *\r\n * register('fibonacci', (n: number) => {\r\n *   if (n <= 1) return n;\r\n *   let a = 0, b = 1;\r\n *   for (let i = 2; i <= n; i++) {\r\n *     [a, b] = [b, a + b];\r\n *   }\r\n *   return b;\r\n * });\r\n * ```\r\n */\r\nexport function register<\r\n  TName extends RegisteredFunctionName,\r\n  TInput = FunctionInput<TName extends string ? TName : never>,\r\n  TOutput = FunctionOutput<TName extends string ? TName : never>,\r\n>(\r\n  name: TName,\r\n  fn: TName extends keyof ComputeFunctionRegistry\r\n    ? ComputeFn<\r\n        ComputeFunctionRegistry[TName]['input'],\r\n        ComputeFunctionRegistry[TName]['output']\r\n      >\r\n    : ComputeFn<TInput, TOutput>\r\n): void {\r\n  getDefaultInstance().register(name, fn);\r\n}\r\n\r\n/**\r\n * Run a function on the default instance\r\n *\r\n * @example\r\n * ```ts\r\n * import { run } from '@computekit/core';\r\n *\r\n * const result = await run('fibonacci', 50);\r\n * console.log(result); // Type is inferred if registry is extended\r\n * ```\r\n */\r\nexport async function run<\r\n  TName extends RegisteredFunctionName,\r\n  TInput = FunctionInput<TName extends string ? TName : never>,\r\n  TOutput = FunctionOutput<TName extends string ? TName : never>,\r\n>(\r\n  name: TName,\r\n  input: TName extends keyof ComputeFunctionRegistry\r\n    ? ComputeFunctionRegistry[TName]['input']\r\n    : TInput,\r\n  options?: ComputeOptions\r\n): Promise<\r\n  TName extends keyof ComputeFunctionRegistry\r\n    ? ComputeFunctionRegistry[TName]['output']\r\n    : TOutput\r\n> {\r\n  return getDefaultInstance().run(name, input, options);\r\n}\r\n\r\n// Re-export types\r\nexport type {\r\n  ComputeKitOptions,\r\n  ComputeOptions,\r\n  ComputeProgress,\r\n  ComputeResult,\r\n  ComputeFunction,\r\n  PoolStats,\r\n  WorkerInfo,\r\n  WasmModuleConfig,\r\n  ComputeKitEvents,\r\n  // Pipeline types\r\n  StageStatus,\r\n  StageInfo,\r\n  StageConfig,\r\n  PipelineMode,\r\n  PipelineStatus,\r\n  PipelineState,\r\n  PipelineMetrics,\r\n  PipelineOptions,\r\n  PipelineEvents,\r\n  // Parallel batch types\r\n  ParallelBatchConfig,\r\n  BatchItemResult,\r\n  ParallelBatchResult,\r\n} from './types';\r\n\r\n// Re-export typed registry types\r\nexport type {\r\n  ComputeFunctionRegistry,\r\n  RegisteredFunctionName,\r\n  FunctionInput,\r\n  FunctionOutput,\r\n  ComputeFn,\r\n  InferComputeFn,\r\n  DefineFunction,\r\n  HasRegisteredFunctions,\r\n} from './registry';\r\n\r\n// Re-export utilities\r\nexport {\r\n  isWasmSupported,\r\n  isSharedArrayBufferAvailable,\r\n  getHardwareConcurrency,\r\n  findTransferables,\r\n} from './utils';\r\n\r\n// Re-export WASM utilities\r\nexport {\r\n  loadWasmModule,\r\n  loadAndInstantiate,\r\n  loadAssemblyScript,\r\n  wrapWasmExports,\r\n  getMemoryView,\r\n  copyToWasmMemory,\r\n  copyFromWasmMemory,\r\n  clearWasmCache,\r\n  getWasmCacheStats,\r\n} from './wasm';\r\n\r\n// Re-export pool\r\nexport { WorkerPool } from './pool';\r\n"]}